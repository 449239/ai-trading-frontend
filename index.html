<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mal's AI Trading Bot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0e1117;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    nav {
      background: #1e1e1e;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
    }
    nav h1 {
      color: #00e676;
      font-size: 1.5rem;
    }
    .container {
      max-width: 960px;
      margin: 2rem auto;
      background-color: #1e1e1e;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 230, 118, 0.2);
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
    }
    input, select, button {
      margin-top: 0.5rem;
      padding: 0.5rem;
      width: 100%;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    select, input {
      background-color: #121212;
      color: #ffffff;
    }
    button {
      background: #00c853;
      color: #fff;
      cursor: pointer;
      margin-top: 1.5rem;
    }
    #chartHTML {
      margin-top: 2rem;
    }
    .section {
      margin-top: 2rem;
      background: #222;
      padding: 1rem;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <nav>
    <div>
      <h1>Mal's Trading Bot</h1>
    </div>
  </nav>

  <div class="container">
    <label for="ticker">Select Market:</label>
    <select id="ticker">
      <option value="AAPL">Apple</option>
      <option value="NQ=F">Nasdaq Futures</option>
      <option value="ES=F">S&P 500 Futures</option>
      <option value="CL=F">Crude Oil Futures</option>
      <option value="GC=F">Gold Futures</option>
      <option value="BTC-USD">Bitcoin</option>
      <option value="ETH-USD">Ethereum</option>
      <option value="USDEUR=X">USD/EUR Forex</option>
      <option value="USDJPY=X">USD/JPY Forex</option>
      <option value="GBPUSD=X">GBP/USD Forex</option>
    </select>

    <label for="strategy">Select Strategy:</label>
    <select id="strategy">
      <option value="Scalping">Scalping</option>
      <option value="Swing Trading">Swing Trading</option>
      <option value="Breakout">Breakout</option>
    </select>

    <label for="indicators">Indicators:</label>
    <select id="indicators" multiple>
      <option value="rsi">RSI</option>
      <option value="macd">MACD</option>
      <option value="ema">EMA</option>
      <option value="bollinger">Bollinger Bands</option>
    </select>

    <label for="theme">Chart Theme:</label>
    <select id="theme">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>

    <label><input type="checkbox" id="draw_tools"> Enable Drawing Tools</label>
    <label><input type="checkbox" id="auto_refresh" checked> Auto Refresh (every 60s)</label>

    <button onclick="playClick(); generateSignal();">Generate Trade Signal</button>

    <div id="signal" class="section"></div>
    <div id="chartHTML"></div>
  </div>

  <audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b5e348f1e0.mp3"></audio>
  <audio id="confirmSound" src="https://cdn.pixabay.com/download/audio/2022/01/20/audio_f79f420d0e.mp3"></audio>

  <script>
    function playClick() {
      document.getElementById('clickSound').play();
    }
    function playConfirm() {
      document.getElementById('confirmSound').play();
    }

    async function generateSignal() {
      const ticker = document.getElementById('ticker').value;
      const strategy = document.getElementById('strategy').value;
      const indicators = Array.from(document.getElementById('indicators').selectedOptions).map(o => o.value);
      const theme = document.getElementById('theme').value;
      const draw = document.getElementById('draw_tools').checked;

      const signalRes = await fetch(`https://ai-trading-backend-production-f5e6.up.railway.app/api/signal?ticker=${ticker}&strategy=${strategy}`);
      const signalData = await signalRes.json();

      if (signalData.signal) {
        document.getElementById("signal").innerHTML = `
          <b>Signal:</b> ${signalData.signal} <br>
          <b>Confidence:</b> ${signalData.confidence}% <br>
          <b>Entry:</b> $${signalData.entry} <br>
          <b>Stop:</b> $${signalData.stop} <br>
          <b>Take Profit:</b> $${signalData.take} <br>
          <b>Support:</b> $${signalData.support} <br>
          <b>Resistance:</b> $${signalData.resistance} <br>
          <b>Reason:</b> ${signalData.reason} <br>
          <b>Time:</b> ${signalData.timestamp} <br>
        `;
        playConfirm();
      } else {
        document.getElementById("signal").innerText = "Error fetching signal.";
      }

      const chartRes = await fetch(`https://ai-trading-backend-production-f5e6.up.railway.app/api/chart?ticker=${ticker}&theme=${theme}&draw=${draw}&indicators=${indicators.join(',')}`);
      const chartHTML = await chartRes.text();
      document.getElementById("chartHTML").innerHTML = chartHTML;
    }

    if (document.getElementById('auto_refresh').checked) {
      setInterval(() => {
        if (document.getElementById('auto_refresh').checked) {
          generateSignal();
        }
      }, 60000);
    }
  </script>
</body>
</html>
